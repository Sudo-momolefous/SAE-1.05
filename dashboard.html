<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Dashboard IP Source</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --bg-color: #0f172a;
  --bg-section: #020617;
  --text-color: #e5e7eb;
  --alert-bg: #7f1d1d;
  --th-bg: #1e293b;
}
body {
 background: var(--bg-color);
 color: var(--text-color);
 font-family: Arial;
 margin:0;
}
nav {
 background: #1e293b;
 padding: 12px 20px;
 display: flex;
 justify-content: space-between;
 align-items: center;
}
nav h1 { margin:0; font-size: 1.2em; }
button {
 padding:6px 12px;
 border:none;
 border-radius:6px;
 cursor:pointer;
}
section {
 background: var(--bg-section);
 margin:20px;
 padding:20px;
 border-radius:12px;
}
.chart-small {
 max-width:500px;
 max-height:400px;
 margin:auto;
}
.alert {
 background: var(--alert-bg);
 padding:10px;
 border-radius:6px;
 margin-top:6px;
}
table {
 width:100%;
 border-collapse:collapse;
 margin-top:10px;
}
th,td {
 border:1px solid #334155;
 padding:8px;
 text-align:center;
}
th { background: var(--th-bg); }
.grid {
 display:grid;
 grid-template-columns:1fr 1fr;
 gap:20px;
 justify-items:center;
}
@media (max-width: 800px) {
 .grid { grid-template-columns:1fr; }
}
</style>
</head>
<body>

<nav>
  <h1>Dashboard</h1>
  <button id="modeBtn">Mode Clair</button>
</nav>

<section class="grid">
<canvas id="barChart" class="chart-small"></canvas>
<canvas id="pieChart" class="chart-small"></canvas>
</section>

<section>
<h3>Score des IP source (nombre de requêtes)</h3>
<table>
<tr><th>IP source</th><th>Score</th></tr>
<tr><td>BP-Linux8</td><td>2950</td></tr><tr><td>www.aggloroanne.fr</td><td>2130</td></tr><tr><td>190-0-175-100.gba.solunet.com.ar</td><td>1969</td></tr><tr><td>mauves.univ-st-etienne.fr</td><td>1687</td></tr><tr><td>par10s38-in-f3.1e100.net</td><td>827</td></tr><tr><td>par21s23-in-f3.1e100.net</td><td>251</td></tr><tr><td>par21s04-in-f4.1e100.net</td><td>223</td></tr><tr><td>par21s17-in-f1.1e100.net</td><td>180</td></tr><tr><td>par21s23-in-f10.1e100.net</td><td>99</td></tr><tr><td>192.168.190.130</td><td>66</td></tr>
</table>
</section>

<section>
<h3>Menaces détectées (IP source uniquement)</h3>
<label for="limitMenaces">Nombre de menaces à afficher: </label>
<input type="number" id="limitMenaces" min="1" max="50" value="10" style="width:60px"/>
<div id="menaces"></div>
</section>

<script>
let darkMode = true;
const modeBtn = document.getElementById("modeBtn");
modeBtn.onclick = function(){
  darkMode=!darkMode;
  if(darkMode){
    document.body.style.background='#0f172a';
    document.body.style.color='#e5e7eb';
    document.querySelectorAll('section').forEach(s=>s.style.background='#020617');
    document.querySelectorAll('.alert').forEach(a=>a.style.background='#7f1d1d');
    document.querySelectorAll('th').forEach(th=>th.style.background='#1e293b');
    modeBtn.textContent="Mode Clair";
  } else {
    document.body.style.background='#f8fafc';
    document.body.style.color='#1e293b';
    document.querySelectorAll('section').forEach(s=>s.style.background='#ffffff');
    document.querySelectorAll('.alert').forEach(a=>a.style.background='#f87171');
    document.querySelectorAll('th').forEach(th=>th.style.background='#e5e7eb');
    modeBtn.textContent="Mode Sombre";
  }
}

const srcData = {"BP-Linux8": 2950, "www.aggloroanne.fr": 2130, "190-0-175-100.gba.solunet.com.ar": 1969, "mauves.univ-st-etienne.fr": 1687, "par10s38-in-f3.1e100.net": 827, "par21s23-in-f3.1e100.net": 251, "par21s04-in-f4.1e100.net": 223, "par21s17-in-f1.1e100.net": 180, "par21s23-in-f10.1e100.net": 99, "192.168.190.130": 66};
const menaces = [{"ip": "BP-Linux8.ssh", "nb": 60}, {"ip": "192.168.190.130", "nb": 66}, {"ip": "190-0-175-100.gba.solunet.com.ar", "nb": 1969}, {"ip": "190-0-175-100.gba.solunet.com.ar.mon", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.zebrasrv", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.zebra", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.ripd", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.ripngd", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.ospfd", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.bgpd", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.ospf6d", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.ospfapi", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.isisd", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.dict", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.f5-globalsite", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.gsiftp", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.gpsd", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.afbackup", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.afmbackup", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.gds-db", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.icpv2", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.iscsi-target", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.mysql", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.nut", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.distcc", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.daap", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.svn", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.suucp", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.sysrqd", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.sieve", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.xtell", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.f5-iquery", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.epmd", "nb": 1}, {"ip": "190-0-175-100.gba.solunet.com.ar.remctl", "nb": 1}, {"ip": "BP-Linux8", "nb": 2950}, {"ip": "par21s05-in-f131.1e100.net", "nb": 27}, {"ip": "82.221.107.34.bc.googleusercontent.com", "nb": 5}, {"ip": "201.181.244.35.bc.googleusercontent.com", "nb": 14}, {"ip": "93.184.220", "nb": 6}, {"ip": "server-54-230-114-7.mrs52.r.cloudfront.net", "nb": 5}, {"ip": "ec2-35-166-112-194.us-west-2.compute.amazonaws.com", "nb": 2}, {"ip": "192.168.115", "nb": 42}, {"ip": "server-54-230-114-73.mrs52.r.cloudfront.net", "nb": 5}, {"ip": "ec2-34-211-70-226.us-west-2.compute.amazonaws.com", "nb": 2}, {"ip": "server-54-230-114-122.mrs52.r.cloudfront.net", "nb": 2}, {"ip": "par21s04-in-f4.1e100.net", "nb": 223}, {"ip": "par10s38-in-f3.1e100.net", "nb": 827}, {"ip": "par21s23-in-f3.1e100.net", "nb": 251}, {"ip": "par21s20-in-f2.1e100.net", "nb": 10}, {"ip": "par21s23-in-f2.1e100.net", "nb": 8}, {"ip": "lhr25s01-in-f2.1e100.net", "nb": 10}, {"ip": "par21s11-in-f14.1e100.net", "nb": 22}, {"ip": "par21s17-in-f1.1e100.net", "nb": 180}, {"ip": "par21s22-in-f14.1e100.net", "nb": 2}, {"ip": "mad01s26-in-f174.1e100.net", "nb": 2}, {"ip": "par10s40-in-f14.1e100.net", "nb": 2}, {"ip": "par21s12-in-f14.1e100.net", "nb": 2}, {"ip": "par21s18-in-f3.1e100.net", "nb": 19}, {"ip": "par10s40-in-f3.1e100.net", "nb": 21}, {"ip": "mauves.univ-st-etienne.fr", "nb": 1687}, {"ip": "par21s11-in-f10.1e100.net", "nb": 28}, {"ip": "par10s28-in-f14.1e100.net", "nb": 2}, {"ip": "par21s20-in-f14.1e100.net", "nb": 46}, {"ip": "www.aggloroanne.fr", "nb": 2130}, {"ip": "par21s17-in-f14.1e100.net", "nb": 50}, {"ip": "par21s23-in-f10.1e100.net", "nb": 99}, {"ip": "91.121.37", "nb": 24}, {"ip": "104.18.31", "nb": 3}, {"ip": "par21s20-in-f10.1e100.net", "nb": 16}];
const colors = ['#3b82f6','#22c55e','#eab308','#ef4444','#a855f7','#14b8a6','#f97316','#ec4899','#84cc16','#06b6d4'];

let barChart=null, pieChart=null;

function drawCharts() {
    if(barChart) barChart.destroy();
    if(pieChart) pieChart.destroy();

    barChart = new Chart(document.getElementById("barChart"), {
        type:'bar',
        data:{
            labels:Object.keys(srcData),
            datasets:[{label:'Nombre de requêtes', data:Object.values(srcData), backgroundColor:colors}]
        },
        options:{responsive:true}
    });

    pieChart = new Chart(document.getElementById("pieChart"), {
        type:'pie',
        data:{
            labels:Object.keys(srcData),
            datasets:[{data:Object.values(srcData), backgroundColor:colors}]
        },
        options:{responsive:true}
    });
}

function updateMenaces(){
    const limit = parseInt(document.getElementById("limitMenaces").value);
    const container = document.getElementById("menaces");
    container.innerHTML = "";

    const sorted = [...menaces].sort((a,b)=>b.nb - a.nb);
    const top = sorted.slice(0, limit);

    if(top.length === 0){
        container.innerHTML = "<div class='alert'>Aucune menace détectée</div>";
    } else {
        for(let item of top){
            const div = document.createElement("div");
            div.className = "alert";
            div.textContent = item.ip + " → " + item.nb + " requêtes";
            container.appendChild(div);
        }
    }
}

document.getElementById("limitMenaces").addEventListener("input", updateMenaces);

drawCharts();
updateMenaces();
</script>
</body>
</html>
